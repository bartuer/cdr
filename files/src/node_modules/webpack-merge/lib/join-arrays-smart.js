"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function uniteRules(e,t,n,r){if(String(r.test)!==String(n.test)||(n.enforce||r.enforce)&&r.enforce!==n.enforce||n.include&&!isSameValue(r.include,n.include)||n.exclude&&!isSameValue(r.exclude,n.exclude))return!1;if(!r.test&&!r.include&&!r.exclude&&(r.loader&&r.loader.split("?")[0])!==(n.loader&&n.loader.split("?")[0]))return!1;if((r.include||r.exclude)&&!n.include&&!n.exclude)return!1;if(r.oneOf&&n.oneOf)return r.oneOf=(0,_unionWith3.default)(r.oneOf,n.oneOf,uniteRules.bind(null,{},"oneOf")),!0;if(n.loader){var i=n.options?"options":n.query&&"query";delete r.use,delete r.loaders,delete r.oneOf,r.loader=n.loader,i&&(r[i]=n[i])}else if(n.oneOf)delete r.use,delete r.loaders,delete r.loader,r.oneOf=n.oneOf;else if((r.use||r.loaders||r.loader)&&(n.use||n.loaders)){var s=function(t){return typeof t=="string"?{loader:t}:t},o=function(t){return!t.options&&!t.query?t.loader:t},u=void 0;if(r.loader){var a=r.options?"options":r.query&&"query";u=[{loader:r.loader}],a&&(u[0][a]=r[a]),delete r.loader,a&&delete r[a]}else u=[].concat(r.use||r.loaders).map(s);var f=[].concat(n.use||n.loaders).map(s),l=r.use||n.use?"use":"loaders",c=t+"."+l;switch(e[c]){case"prepend":r[l]=[].concat(_toConsumableArray((0,_differenceWith3.default)(f,u,uniteEntries)),_toConsumableArray(u)).map(o);break;case"replace":r[l]=n.use||n.loaders;break;default:r[l]=combineEntries(f,u).map(o)}}return n.include&&(r.include=n.include),n.exclude&&(r.exclude=n.exclude),!0}function isSameValue(e,t){var n=[e,t].map(function(e){return isArray(e)?[].concat(_toConsumableArray(e)).sort():e}),r=_slicedToArray(n,2),i=r[0],s=r[1];return(0,_isEqual3.default)(i,s)}function areEqualEntries(e,t){var n=/^([^?]+)/ig,r=t.loader.match(n),i=_slicedToArray(r,1),s=i[0],o=e.loader.match(n),u=_slicedToArray(o,1),a=u[0];return s===a}function uniteEntries(e,t){return areEqualEntries(e,t)?((0,_mergeWith3.default)(t,e),!0):!1}function combineEntries(e,t){var n=[],r=t.length-1;for(var i=e.length-1;i>=0;i-=1){var s=e[i],o=findLastIndexUsingComparinator(t,s,areEqualEntries,r),u=o!==-1;if(u){for(var a=r;a>o;a-=1){var f=t[a],l=findLastIndexUsingComparinator(e,f,areEqualEntries,i)!==-1;l||n.unshift(f),r-=1}uniteEntries(s,t[r]),n.unshift(t[r]),r-=1}else{var c=findLastIndexUsingComparinator(n,s,areEqualEntries)!==-1;c||n.unshift(s)}}for(r;r>=0;r-=1){var h=t[r],p=findLastIndexUsingComparinator(n,h,areEqualEntries)!==-1;p||n.unshift(h)}return n}function findLastIndexUsingComparinator(e,t,n,r){r=r||e.length-1;for(var i=r;i>=0;i-=1)if(areEqualEntries(t,e[i]))return i;return-1}Object.defineProperty(exports,"__esModule",{value:!0}),exports.uniteEntries=exports.uniteRules=undefined;var _unionWith2=require("lodash/unionWith"),_unionWith3=_interopRequireDefault(_unionWith2),_differenceWith2=require("lodash/differenceWith"),_differenceWith3=_interopRequireDefault(_differenceWith2),_mergeWith2=require("lodash/mergeWith"),_mergeWith3=_interopRequireDefault(_mergeWith2),_isEqual2=require("lodash/isEqual"),_isEqual3=_interopRequireDefault(_isEqual2),_slicedToArray=function(){function e(e,t){var n=[],r=!0,i=!1,s=undefined;try{for(var o=e[Symbol.iterator](),u;!(r=(u=o.next()).done);r=!0){n.push(u.value);if(t&&n.length===t)break}}catch(a){i=!0,s=a}finally{try{!r&&o["return"]&&o["return"]()}finally{if(i)throw s}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),isArray=Array.isArray;exports.uniteRules=uniteRules,exports.uniteEntries=uniteEntries;